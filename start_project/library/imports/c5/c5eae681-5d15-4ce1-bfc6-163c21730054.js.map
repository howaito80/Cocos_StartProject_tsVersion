{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\tsVersion/assets\\scripts\\tsVersion\\Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\tsVersion","sourcesContent":["const {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport class Player extends cc.Component {\r\n\r\n    @property(cc.Integer)\r\n    jumpHeight: number = 0;\r\n\r\n    @property(cc.Integer)\r\n    private accel: number = 0;\r\n\r\n    @property(cc.Integer)\r\n    private jumpDuration: number = 0;\r\n    \r\n    @property(cc.Integer)\r\n    private maxMoveSpeed: number = 0;\r\n\r\n    @property(cc.AudioClip)\r\n    private jumpAudio: cc.AudioClip = null;\r\n\r\n    private xSpeed: number = 0;\r\n    private accLeft: boolean = false;\r\n    private accRight: boolean = false;\r\n    private jumpAction: cc.Action = null;\r\n\r\n    waitForSomething(ms: number)\r\n    {\r\n        console.log(\"please wait..\")\r\n        return new Promise(resolve => setTimeout(resolve, ms))\r\n    }\r\n    async startDoingSomething()\r\n    {\r\n        await this.waitForSomething(5000);\r\n        console.info(\"Stop doing something\");\r\n    }\r\n\r\n    start () \r\n    {\r\n\r\n        this.startDoingSomething();\r\n        // bind listeners\r\n        this.bindEventListener(true);\r\n        // jump action\r\n        this.jumpAction = this.getJumpAction();\r\n        this.node.runAction(this.jumpAction);\r\n    }\r\n\r\n    update (dt: number) \r\n    {\r\n        if(this.accLeft)\r\n            this.xSpeed -= this.accel * dt;\r\n        else if(this.accRight)\r\n            this.xSpeed += this.accel * dt;\r\n        else if(Math.abs(this.xSpeed) > 0) // 无输入则减速\r\n        {\r\n            let curSpeed = this.xSpeed;\r\n\r\n            curSpeed -= this.accel * Math.abs(curSpeed) / curSpeed * dt;\r\n            if(curSpeed * this.xSpeed < 0)\r\n                curSpeed = 0;\r\n\r\n            this.xSpeed = curSpeed;\r\n        }\r\n\r\n        // 加速\r\n        if(Math.abs(this.xSpeed) > this.maxMoveSpeed)\r\n            this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);\r\n        \r\n        this.node.x += this.xSpeed;\r\n\r\n        // 边界\r\n        let maxX = this.node.parent.width / 2;\r\n        if(Math.abs(this.node.x) > maxX)\r\n        {\r\n            this.node.x = maxX * this.node.x / Math.abs(this.node.x);\r\n            this.xSpeed = 0;\r\n        }\r\n    }\r\n\r\n    onDestroy()\r\n    {\r\n        this.bindEventListener(false);\r\n    }\r\n\r\n    private getJumpAction()\r\n    {\r\n        let jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc.easeCubicActionOut());\r\n        let jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc.easeCubicActionIn());\r\n\r\n        let jumpActionCallback = cc.callFunc(this.playJumpAudio, this);// 回调:播放跳跃音效\r\n        return cc.repeatForever(cc.sequence(jumpUp, jumpDown, jumpActionCallback));\r\n    }\r\n\r\n    private playJumpAudio()\r\n    {\r\n        cc.audioEngine.play(this.jumpAudio, false, 1);\r\n    }\r\n\r\n    private bindEventListener(status: boolean)\r\n    {\r\n        if(status)\r\n        {\r\n            cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n            cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n        }\r\n        else\r\n        {\r\n            cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n            cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n        }\r\n    }\r\n\r\n    private onKeyDown(event: cc.Event.EventKeyboard)\r\n    {\r\n        switch(event.keyCode)\r\n        {\r\n            case cc.macro.KEY.a:\r\n                this.accLeft = true;\r\n                break;\r\n            case cc.macro.KEY.d:\r\n                this.accRight = true;\r\n                break;\r\n        }\r\n    }\r\n    private onKeyUp(event: cc.Event.EventKeyboard)\r\n    {\r\n        switch(event.keyCode)\r\n        {\r\n            case cc.macro.KEY.a:\r\n                this.accLeft = false;\r\n                break;\r\n            case cc.macro.KEY.d:\r\n                this.accRight = false;\r\n                break;\r\n        }\r\n    }\r\n}\r\n"]}